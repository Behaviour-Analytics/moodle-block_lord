/*! moodle-block_lord v0.3.6 07-08-2020 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.lord=a()}(function(){return function(a){function b(a){G=a.modules,L=a.weights,N=a.coordsscript,P=a.courseid,O=a.sesskey,Q=a.names,R=a.paragraphs,S=a.sentences,W=a.matrices,T=a.comparisonweights,z=window.dataDrivenDocs,A=window.munkres,B=c(),C={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown"},D=window.innerWidth-150,E=window.innerHeight-90,F=Math.min(D,E)<500?6:8,_=25,aa=200,ba=1e3,d(),e(),i(),j()}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){G.forEach(function(a){for(;!C[a.entype];){var b=B[Math.floor(Math.random()*B.length)],c=!0;for(var d in C)C[d]==b&&(c=!1);C[a.entype]=c?b:void 0}})}function e(){var a=[],b=[],c={},d={};G.forEach(function(e){d={id:e.id,name:e.name,type:e.type,entype:e.entype,colour:C[e.entype],visible:!0},a[a.length]=d,c[e.sect]||(d={id:"g"+e.sect,name:M.util.get_string("section","block_lord")+" "+e.sect,group:e.sect,type:"grouping",colour:C.grouping,visible:!1},c[e.sect]=d,a[a.length]=d),b[b.length]={source:"g"+e.sect,target:e.id,weight:0,colour:C.originalLinks}}),d={id:"root",name:"root",group:-1,type:"grouping",colour:C.grouping,visible:!1},a[a.length]=d;for(var e in c)b[b.length]={source:"root",target:c[e].id,weight:0,colour:C.originalLinks};var g,h;c={},G.forEach(function(a){G.forEach(function(d){g=parseInt(a.id)<parseInt(d.id)?a.id+"_"+d.id:d.id+"_"+a.id,a.id==d.id||c[g]||(c[g]=1,h=0,h=!L[g]||Array.isArray(L[g])?-.01:f(g),b[b.length]={source:a.id,target:d.id,weight:h,colour:C.originalLinks})})}),H={nodes:a,links:b}}function f(a){var b=0,c=0,d=0,e=0,f=0,i=[],j={},k={};for(var l in L[a])"name"==l?b+=parseFloat(L[a][l])*parseFloat(T.names):l.startsWith("intro")?(j[l]=parseFloat(L[a][l]),i=l.slice(5).split("x"),parseInt(i[0])>c&&(c=parseInt(i[0])),parseInt(i[1])>c&&(c=parseInt(i[1]))):(i=l.split("P"),e=i[1].split("S"),d<e[0]&&(d=e[0]),f=i[2].split("S"),d<f[0]&&(d=f[0]),k[e[0]+"_"+f[0]]||(k[e[0]+"_"+f[0]]={}),k[e[0]+"_"+f[0]][e[1]+"_"+f[1]]=parseFloat(L[a][l]));var m=g(c,j),n=h(d,k);return 0!=n?(b+m+n)/3:(b+m)/2}function g(a,b){var c=[],d=0,e=0;for(d=0;d<=a;d++)for(c[d]=[],e=0;e<=a;e++)c[d][e]=-1e3;var f=[];d=0;for(d in b)f=d.slice(5).split("x"),c[parseInt(f[0])][parseInt(f[1])]=b[d];var g=A.make_cost_matrix(c),h=A(g),i=0,j=0,k=0;for(d=0;d<h.length;d++)(k=c[h[d][0]][h[d][1]])>=-1&&(i+=k,j++);return i=j>0?i/j:0,X={matrix:c,optimal:h,weight:i},i*=parseFloat(T.intros)}function h(a,b){var c=[],d=0,e=0;for(d=0;d<=a;d++)for(c[d]=[],e=0;e<=a;e++)c[d][e]=-1e3;var f=[],g=[],h=[],i=[],j=0,k=0,l=0,m=[],n=[],o=0,p=0,q=0,r=0;Y={};for(var s in b)if(f=s.split("_"),i=Object.keys(b[s]),0!=i.length){j=0,k=0,l=0;for(q in i)g=i[q].split("_"),k=parseInt(g[0]),j<k&&(j=k),l=parseInt(g[1]),j<l&&(j=l);for(h=[],d=0;d<=j;d++)for(h[d]=[],e=0;e<=j;e++)h[d][e]=-1e3;for(q in i)g=i[q].split("_"),k=parseInt(g[0]),l=parseInt(g[1]),h[k][l]=b[s][i[q]];for(m=A.make_cost_matrix(h),n=A(m),p=0,o=0,d=0;d<n.length;d++)(r=h[n[d][0]][n[d][1]])>=-1&&(o+=r,p++);o=p>0?o/p:0,Y[s]={matrix:h,optimal:n,weight:o},k=parseInt(f[0]),l=parseInt(f[1]),c[k][l]=o}m=A.make_cost_matrix(c),n=A(m);var t=0;for(p=0,r=0,d=0;d<n.length;d++)(r=c[n[d][0]][n[d][1]])>=-1&&(t+=r,p++);return t=p>0?t/p:0,Z={matrix:c,optimal:n,weight:t},t*=parseFloat(T.sentences)}function i(){I=z.select("#graph").append("svg").attr("width",D).attr("height",E).on("click",o);var a=z.forceLink(H.links).id(function(a){return a.id}).distance(function(a){var b=a.weight*-parseInt(ba);return b+=parseInt(aa)});$=z.forceSimulation(H.nodes).force("link",a).force("collide",z.forceCollide().radius(parseInt(_))).force("center",z.forceCenter(D/2,E/2)),J=I.selectAll(".node").data(H.nodes).enter().append("circle").attr("class","node").attr("r",F).on("click",p).on("contextmenu",q).call(z.drag().on("start",l).on("drag",m).on("end",n)),K=I.selectAll(".link").data(H.links).enter().append("line").attr("class","link").style("stroke",C.originalLinks).style("stroke-width","2px"),$.on("tick",k)}function j(){var a=document.getElementById("save-graph"),b=document.createElement("input");b.type="button",b.value=M.util.get_string("savebutton","block_lord"),b.addEventListener("click",w),b.style.marginRight="20px",a.appendChild(b);var c=document.createElement("input");c.id="min-dist-slider",c.type="range",c.min="10",c.max="50",c.step="5",c.value="25",c.style.width="100px",c.addEventListener("change",function(){_=this.value,I.remove(),i(),document.getElementById("min-dist-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(c);var d=document.createTextNode(M.util.get_string("mindistance","block_lord"));a.appendChild(d),d=document.createElement("label"),d.id="min-dist-output",d.innerHTML="&nbsp;= "+c.value,d.style.marginRight="20px",a.appendChild(d);var e=document.createElement("input");e.id="max-dist-slider",e.type="range",e.min="50",e.max="500",e.step="25",e.value="200",e.style.width="100px",e.addEventListener("change",function(){aa=this.value,I.remove(),i(),document.getElementById("max-dist-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(e),d=document.createTextNode(M.util.get_string("maxdistance","block_lord")),a.appendChild(d),d=document.createElement("label"),d.id="max-dist-output",d.innerHTML="&nbsp;= "+e.value,d.style.marginRight="20px",a.appendChild(d);var f=document.createElement("input");f.id="scale-slider",f.type="range",f.min="0",f.max="2000",f.step="100",f.value="1000",f.style.width="100px",f.addEventListener("change",function(){ba=this.value,I.remove(),i(),document.getElementById("scale-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(f),d=document.createTextNode(M.util.get_string("scalingfactor","block_lord")),a.appendChild(d),d=document.createElement("label"),d.id="scale-output",d.innerHTML="&nbsp;= "+f.value,d.style.marginRight="20px",a.appendChild(d)}function k(){var a=F;J.attr("cx",function(b){return b.x=Math.max(a,Math.min(D-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(E-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),K.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 10*a.weight+"px"})}function l(a){z.event.active||$.alphaTarget(.01).restart(),a.fx=a.x,a.fy=a.y}function m(a){a.fx=z.event.x,a.fy=z.event.y}function n(a){z.event.active||$.alphaTarget(1e-4),a.fx=null,a.fy=null}function o(){document.getElementById("node-content-left").innerHTML="&nbsp",document.getElementById("node-content-right").innerHTML="&nbsp",document.getElementById("similarity-score").innerHTML="&nbsp",document.getElementById("similarity-matrix").innerHTML="&nbsp",U=void 0,V=void 0}function p(a){z.event.stopPropagation(),a.id!=V&&(U=a.id,r(a,"node-content-left"))}function q(a){z.event.preventDefault(),a.id!=U&&(V=a.id,r(a,"node-content-right"))}function r(a,b){var c="<b>"+M.util.get_string("moduleid","block_lord")+": "+a.id+"<br>"+M.util.get_string("name","block_lord")+": </b>"+Q[a.id].name+"<br><b>"+M.util.get_string("intro","block_lord")+": </b>"+Q[a.id].intro+"<br>";if(R[a.id]){var d=0;R[a.id].forEach(function(a){c+="<b>P"+d+": </b>"+a+"<br>",d++})}document.getElementById(b).innerHTML=c,s()}function s(){if(U&&V){var a=document.getElementById("similarity-score"),b=parseInt(U)<parseInt(V)?U+"_"+V:V+"_"+U;if(Object.keys(L[b]).length>0){var c=f(b);0==c?a.innerHTML=M.util.get_string("comparisonerror","block_lord"):(a.innerHTML=M.util.get_string("similaritystr","block_lord")+" "+c,t(b))}else a.innerHTML=M.util.get_string("notcalculated","block_lord")}}function t(a){var b=document.getElementById("similarity-matrix");b.innerHTML="&nbsp;";var c=a.split("_"),d=function(a,b){return a<b?1:a>b?-1:0};if(Object.keys(W[a]).length>0)for(var e,f,g,h,i,j,k,l,m,n,o,p=Object.keys(W[a]).sort(d),q=!1,r=!1,s=M.util.get_string("optimalassign","block_lord")+":",t=0;t<p.length;t++){if("name"==(o=p[t]))e=M.util.get_string("names","block_lord"),l=Q[c[0]].cname,m=Q[c[1]].cname;else if(o.startsWith("intro"))q||(n=M.util.get_string("introscost","block_lord")+" "+c[1]+" x "+c[0],u(n,s,b,X),q=!0),g=o.slice(5).split("x"),e=M.util.get_string("intros","block_lord")+" "+c[1]+" S"+g[1]+" x "+c[0]+" S"+g[0],l=Q[c[0]].cintro[g[0]],m=Q[c[1]].cintro[g[1]];else{if(!r){n=M.util.get_string("parascost","block_lord")+" "+c[1]+" x "+c[0],u(n,s,b,Z);for(var w in Y)g=w.split("_"),n=M.util.get_string("sentscost","block_lord")+" "+c[1]+" P"+g[1]+" x "+c[0]+" P"+g[0],u(n,s,b,Y[w]);r=!0}f=o.split("P"),g=f[1].split("S"),h=parseInt(g[0]),i=parseInt(g[1]),g=f[2].split("S"),j=parseInt(g[0]),k=parseInt(g[1]),e=c[1]+" P"+j+"S"+k+" x "+c[0]+" P"+h+"S"+i,l=S[c[0]][h][i],m=S[c[1]][j][k]}v(e,b,m,l,W[a][o],L[a][o])}}function u(a,b,c,d){var e=document.createElement("table"),f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(a);g.appendChild(h),g.appendChild(document.createElement("br"));var i=document.createTextNode("   "+d.weight);g.appendChild(i),g.style.fontWeight="bold";var j=0;for(j=0;j<d.matrix.length;j++)g=f.insertCell(),h=document.createTextNode(j),g.appendChild(h);for(j=0;j<d.matrix.length;j++){f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(j),g.appendChild(h);for(var k=0;k<d.matrix[0].length;k++)g=f.insertCell(),h=document.createTextNode(d.matrix[j][k]),g.appendChild(h)}for(c.appendChild(e),e=document.createElement("table"),f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(b),g.appendChild(h),g.style.fontWeight="bold",j=0;j<d.optimal.length;j++)g=f.insertCell(),h=document.createTextNode(d.optimal[j]),g.appendChild(h);c.appendChild(e),c.appendChild(document.createElement("hr"))}function v(a,b,c,d,e,f){var g=document.createElement("table"),h=g.insertRow(),i=h.insertCell(),j=document.createTextNode(a);i.appendChild(j),i.appendChild(document.createElement("br"));var k=document.createTextNode("   "+f);if(i.appendChild(k),i.style.fontWeight="bold",!e)return b.appendChild(g),void b.appendChild(document.createElement("hr"));for(var l=c.split(" "),m=0;m<e[0].length;m++)i=h.insertCell(),j=document.createTextNode(l[m]),i.appendChild(j);l=d.split(" ");var n=0;e.forEach(function(a){h=g.insertRow(),i=h.insertCell(),j=document.createTextNode(l[n++]),i.appendChild(j),a.forEach(function(a){i=h.insertCell(),j=document.createTextNode(a.toFixed(6)),i.appendChild(j)})}),b.appendChild(g),b.appendChild(document.createElement("hr"))}function w(){var a=x();a.time=Date.now(),y(N,a)}function x(){var a,b,c,d={},e=0,f=D/2,g=E/2;return H.nodes.forEach(function(d){a=d.x-f,b=d.y-g,(c=Math.sqrt(a*a+b*b))>e&&(e=c)}),d.scale=e,H.nodes.forEach(function(a){d[a.id]={xcoord:""+(a.x-f)/e,ycoord:""+(a.y-g)/e}}),d}function y(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+P+"&data="+JSON.stringify(b)+"&sesskey="+O)}var z,A,B,C,D,E,F,G,H,I,J,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba;b(a)}});