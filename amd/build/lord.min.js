/*! moodle-block_lord v0.3.6 15-09-2020 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.lord=a()}(function(){return function(a){function b(a){R=a.modules,W=a.weights,X=a.coordsscript,Z=a.courseid,Y=a.sesskey,$=a.names,_=a.paragraphs,aa=a.sentences,ea=a.matrices,ba=a.comparisonweights,ma=a.presetnodes,J=window.dataDrivenDocs,K=window.munkres,L=c(),N={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},O=window.innerWidth-150,P=window.innerHeight-90,Q=Math.min(O,P)<500?6:8,ja=25,ka=200,la=1e3,pa=7e3,d(),Object.keys(ma.usergraph).length>0?(na=ma.userscale,ja=ma.usermindist,ka=ma.usermaxdist,la=ma.userdistscale,e(ma.usergraph),i(q,!0),j(),oa=!0,x("usergraph")):Object.keys(ma.systemgraph).length>0?(na=ma.systemscale,ja=ma.systemmindist,ka=ma.systemmaxdist,la=ma.systemdistscale,e(ma.systemgraph),i(q,!0),j(),oa=!1,x("systemgraph")):(e({}),i(p,!1),setTimeout(function(){G(!1),j(),oa=!1,x("graphsaved"),U.call(J.drag().on("start",u).on("drag",v).on("end",w))},pa)),qa={min:ja,max:ka,scale:la}}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){R.forEach(function(a){for(;!N[a.entype];){var b=L[Math.floor(Math.random()*L.length)],c=!0;for(var d in N)N[d]==b&&(c=!1);N[a.entype]=c?b:void 0}})}function e(a){var b=[],c=[],d={},e={};R.forEach(function(f){e={id:f.id,name:f.name,type:f.type,entype:f.entype,colour:N[f.entype],visible:!0},a[f.id]&&(e.xcoord=a[f.id].xcoord,e.ycoord=a[f.id].ycoord),b[b.length]=e,d[f.sect]||(e={id:"g"+f.sect,name:M.util.get_string("section","block_lord")+" "+f.sect,group:f.sect,type:"grouping",colour:N.grouping,visible:!1},a["g"+f.sect]&&(e.xcoord=a["g"+f.sect].xcoord,e.ycoord=a["g"+f.sect].ycoord),d[f.sect]=e,b[b.length]=e),c[c.length]={source:"g"+f.sect,target:f.id,weight:0,colour:N.originalLinks}}),e={id:"root",name:"root",group:-1,type:"grouping",colour:N.grouping,visible:!1},a.root&&(e.xcoord=a.root.xcoord,e.ycoord=a.root.ycoord),b[b.length]=e;for(var g in d)c[c.length]={source:"root",target:d[g].id,weight:0,colour:N.originalLinks};var h,i;d={},R.forEach(function(a){R.forEach(function(b){h=parseInt(a.id)<parseInt(b.id)?a.id+"_"+b.id:b.id+"_"+a.id,a.id==b.id||d[h]||(d[h]=1,i=0,i=!W[h]||Array.isArray(W[h])?-.01:f(h),c[c.length]={source:a.id,target:b.id,weight:i,colour:N.originalLinks})})}),S={nodes:b,links:c}}function f(a){var b=0,c=0,d=0,e=0,f=0,i=[],j={},k={};for(var l in W[a])"name"==l?b+=parseFloat(W[a][l])*parseFloat(ba.names):l.startsWith("intro")?(j[l]=parseFloat(W[a][l]),i=l.slice(5).split("x"),parseInt(i[0])>c&&(c=parseInt(i[0])),parseInt(i[1])>c&&(c=parseInt(i[1]))):(i=l.split("P"),e=i[1].split("S"),d<e[0]&&(d=e[0]),f=i[2].split("S"),d<f[0]&&(d=f[0]),k[e[0]+"_"+f[0]]||(k[e[0]+"_"+f[0]]={}),k[e[0]+"_"+f[0]][e[1]+"_"+f[1]]=parseFloat(W[a][l]));var m=g(c,j),n=h(d,k);return 0!=n?(b+m+n)/3:(b+m)/2}function g(a,b){var c=[],d=0,e=0;for(d=0;d<=a;d++)for(c[d]=[],e=0;e<=a;e++)c[d][e]=-1e3;var f=[];d=0;for(d in b)f=d.slice(5).split("x"),c[parseInt(f[0])][parseInt(f[1])]=b[d];var g=K.make_cost_matrix(c),h=K(g),i=0,j=0,k=0;for(d=0;d<h.length;d++)(k=c[h[d][0]][h[d][1]])>=-1&&(i+=k,j++);return i=j>0?i/j:0,fa={matrix:c,optimal:h,weight:i},i*=parseFloat(ba.intros)}function h(a,b){var c=[],d=0,e=0;for(d=0;d<=a;d++)for(c[d]=[],e=0;e<=a;e++)c[d][e]=-1e3;var f=[],g=[],h=[],i=[],j=0,k=0,l=0,m=[],n=[],o=0,p=0,q=0,r=0;ga={};for(var s in b)if(f=s.split("_"),i=Object.keys(b[s]),0!=i.length){j=0,k=0,l=0;for(q in i)g=i[q].split("_"),k=parseInt(g[0]),j<k&&(j=k),l=parseInt(g[1]),j<l&&(j=l);for(h=[],d=0;d<=j;d++)for(h[d]=[],e=0;e<=j;e++)h[d][e]=-1e3;for(q in i)g=i[q].split("_"),k=parseInt(g[0]),l=parseInt(g[1]),h[k][l]=b[s][i[q]];for(m=K.make_cost_matrix(h),n=K(m),p=0,o=0,d=0;d<n.length;d++)(r=h[n[d][0]][n[d][1]])>=-1&&(o+=r,p++);o=p>0?o/p:0,ga[s]={matrix:h,optimal:n,weight:o},k=parseInt(f[0]),l=parseInt(f[1]),c[k][l]=o}m=K.make_cost_matrix(c),n=K(m);var t=0;for(p=0,r=0,d=0;d<n.length;d++)(r=c[n[d][0]][n[d][1]])>=-1&&(t+=r,p++);return t=p>0?t/p:0,ha={matrix:c,optimal:n,weight:t},t*=parseFloat(ba.sentences)}function i(a,b){T&&(ia.stop(),T.remove()),T=J.select("#graph").append("svg").attr("width",O).attr("height",P).on("click",y);var c=J.forceLink(S.links).id(function(a){return a.id}).distance(function(a){var b=a.weight*-parseInt(la);return b+=parseInt(ka)});ia=J.forceSimulation(S.nodes).force("link",c).force("collide",J.forceCollide().radius(parseInt(ja))).force("center",J.forceCenter(O/2,P/2)),U=T.selectAll(".node").data(S.nodes).enter().append("circle").attr("class","node").attr("r",Q).on("click",z).on("contextmenu",A).on("mouseover",r).on("mouseout",t),b&&U.call(J.drag().on("start",u).on("drag",v).on("end",w)),V=T.selectAll(".link").data(S.links).enter().append("line").attr("class","link").style("stroke",N.originalLinks).style("stroke-width","2px"),ia.on("tick",a)}function j(){var a=document.getElementById("save-graph");k("revert-button",M.util.get_string("systembutton","block_lord"),n,a);var b=document.createElement("div"),c=l("min-dist-slider",10,50,5,ja);c.addEventListener("change",function(){ja=this.value,document.getElementById("min-dist-output").innerHTML="&nbsp;= "+this.value}),b.appendChild(c),m(M.util.get_string("mindistance","block_lord"),"min-dist-output",c.value,b),a.appendChild(b),b=document.createElement("div");var d=l("max-dist-slider",50,500,25,ka);d.addEventListener("change",function(){ka=this.value,document.getElementById("max-dist-output").innerHTML="&nbsp;= "+this.value}),b.appendChild(d),m(M.util.get_string("maxdistance","block_lord"),"max-dist-output",d.value,b),a.appendChild(b),b=document.createElement("div");var e=l("scale-slider",0,2e3,100,la);e.addEventListener("change",function(){la=this.value,document.getElementById("scale-output").innerHTML="&nbsp;= "+this.value}),b.appendChild(e),m(M.util.get_string("scalingfactor","block_lord"),"scale-output",e.value,b),a.appendChild(b),k("reset-button",M.util.get_string("resetbutton","block_lord"),o,a),ra=!0,b=document.createElement("div");var f=document.createElement("input");f.type="checkbox",f.checked=1,f.addEventListener("click",function(){ra=!ra}),f.style.marginRight="5px",b.appendChild(f),m(M.util.get_string("runphysics","block_lord"),"run-physics","",b),a.appendChild(b)}function k(a,b,c,d){var e=document.createElement("input");e.id=a,e.type="button",e.value=b,e.addEventListener("click",c),e.style.marginRight="20px",e.style.float="left",d.appendChild(e)}function l(a,b,c,d,e){var f=document.createElement("input");return f.id=a,f.type="range",f.min=b,f.max=c,f.step=d,f.value=e,f.style.width="100px",f}function m(a,b,c,d){var e=document.createTextNode(a);d.appendChild(e),e=document.createElement("label"),e.id=b,e.innerHTML=""==c?"":"&nbsp;= "+c,e.style.marginRight="20px",d.appendChild(e),d.style.float="left"}function n(){!oa&&Object.keys(ma.usergraph).length>0?(na=ma.userscale,ja=ma.usermindist,ka=ma.usermaxdist,la=ma.userdistscale,e(ma.usergraph),i(q,!0),oa=!0,x("usergraph"),document.getElementById("revert-button").value=M.util.get_string("systembutton","block_lord")):(na=ma.systemscale,ja=ma.systemmindist,ka=ma.systemmaxdist,la=ma.systemdistscale,e(ma.systemgraph),i(q,!0),oa=!1,x("systemgraph"),document.getElementById("revert-button").value=Object.keys(ma.usergraph).length>0?M.util.get_string("custombutton","block_lord"):M.util.get_string("systembutton","block_lord")),qa={min:ja,max:ka,scale:la},document.getElementById("min-dist-slider").value=ja,document.getElementById("min-dist-output").innerHTML="&nbsp;= "+ja,document.getElementById("max-dist-slider").value=ka,document.getElementById("max-dist-output").innerHTML="&nbsp;= "+ka,document.getElementById("scale-slider").value=la,document.getElementById("scale-output").innerHTML="&nbsp;= "+la}function o(){ra&&(e({}),i(p,!1),document.getElementById("save-graph").style.display="none",qa={min:ja,max:ka,scale:la},setTimeout(function(){oa=!1,G(!1),x("graphsaved"),U.call(J.drag().on("start",u).on("drag",v).on("end",w)),document.getElementById("save-graph").style.display="block",document.getElementById("revert-button").value=M.util.get_string("custombutton","block_lord")},pa))}function p(){var a=Q;U.attr("cx",function(b){return b.x=Math.max(a,Math.min(O-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(P-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),V.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 10*a.weight+"px"})}function q(){for(var a,b,c=O/2,d=P/2,e=na,f=0;f<S.nodes.length;f++)a=S.nodes[f].xcoord*e+c,b=S.nodes[f].ycoord*e+d,(a<0||a>O||b<0||b>P)&&(e*=.9,--f);V.attr("x1",function(a){var b=S.nodes.filter(function(b){var c="string"==typeof a.source?a.source:a.source.id;return b.id==c})[0];return J.select(this).attr("y1",b.ycoord*e+d),b.xcoord*e+c}).attr("x2",function(a){var b=S.nodes.filter(function(b){var c="string"==typeof a.target?a.target:a.target.id;return b.id==c})[0];return J.select(this).attr("y2",b.ycoord*e+d),b.xcoord*e+c}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}).style("stroke-width",function(a){return 10*a.weight+"px"}),U.attr("cx",function(a){return a.x=a.xcoord*e+c,a.x}).attr("cy",function(a){return a.y=a.ycoord*e+d,a.y}).style("display",function(a){return a.visible?"block":"none"}).style("fill",function(a){return a.colour}).raise()}function r(a){J.selectAll(".text").remove(),J.selectAll("rect").remove();var b=[0],c=!1,d=!1,e=!1,f=150,g=304,h=a.type+" "+a.name,i=T.append("text").attr("class","text").attr("id","t-"+a.id).attr("y",a.y+32).attr("dy",".40em").style("pointer-events","none").text(h).call(s,f,a.x-(f+6)/2+8,b),j=16*b[0]+16;j+a.y>=P-154&&(i.attr("y",P-j-(P-a.y)).text(h).call(s,f,a.x-(f+6)/2+8,b),c=!0),a.x<=g/2?(i.text(h).call(s,f,a.x+8,b),e=!0):a.x>=O-g/2&&(i.text(h).call(s,f,a.x-(f+6)+8,b),d=!0);var k;k=e?a.x:d?a.x-(f+6):a.x-(f+6)/2,T.append("rect").attr("id","r-"+a.id).attr("x",k).attr("y",c?P-j-16-(P-a.y):a.y+16).attr("width",f+16).attr("height",j).style("stroke","black").style("fill","yellow"),i.raise()}function s(a,b,c,d){var e=0;a.each(function(){var a,d=J.select(this),f=d.text().split(/\s+/).reverse(),g=[],h=d.attr("y"),i=parseFloat(d.attr("dy")),j=d.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy",i+"em");for(a=f.pop();a;)g.push(a),j.text(g.join(" ")),j.node().getComputedTextLength()>b&&(g.pop(),j.text(g.join(" ")),g=[a],j=d.append("tspan").attr("x",c).attr("y",h).attr("dy",1.1*++e+i+"em").text(a)),a=f.pop()}),d[0]=++e}function t(){J.selectAll(".text").remove(),J.selectAll("rect").remove()}function u(a){J.event.active||(ia.on("tick",p),ra?ia.alphaTarget(.01).restart():ia.stop()),a.fx=a.x,a.fy=a.y}function v(a){a.fx=J.event.x,a.fy=J.event.y}function w(a){a.fx=null,a.fy=null,oa=!0,ra&&(G(!0),document.getElementById("revert-button").value=M.util.get_string("systembutton","block_lord"),x("graphsaved"))}function x(a){var b=document.getElementById("save-graph"),c=document.createElement("label");c.innerHTML=M.util.get_string(a,"block_lord"),b.appendChild(c),setTimeout(function(){c.remove()},2e3)}function y(){document.getElementById("node-content-left").innerHTML="&nbsp",document.getElementById("node-content-right").innerHTML="&nbsp",document.getElementById("similarity-score").innerHTML="&nbsp",document.getElementById("similarity-matrix").innerHTML="&nbsp",ca=void 0,da=void 0}function z(a){J.event.stopPropagation(),a.id!=da&&(ca=a.id,B(a,"node-content-left"))}function A(a){J.event.preventDefault(),a.id!=ca&&(da=a.id,B(a,"node-content-right"))}function B(a,b){var c="<b>"+M.util.get_string("moduleid","block_lord")+": "+a.id+"<br>"+M.util.get_string("name","block_lord")+": </b>"+$[a.id].name+"<br><b>"+M.util.get_string("intro","block_lord")+": </b>"+$[a.id].intro+"<br>";if(_[a.id]){var d=0;_[a.id].forEach(function(a){c+="<b>P"+d+": </b>"+a+"<br>",d++})}document.getElementById(b).innerHTML=c,C()}function C(){if(ca&&da){var a=document.getElementById("similarity-matrix");a.innerHTML="&nbsp;";var b=document.getElementById("similarity-score"),c=parseInt(ca)<parseInt(da)?ca+"_"+da:da+"_"+ca;if(Object.keys(W[c]).length>0){var d=f(c);0==d?b.innerHTML=M.util.get_string("comparisonerror","block_lord"):(b.innerHTML=M.util.get_string("similaritystr","block_lord")+" "+d,D(c,a))}else b.innerHTML=M.util.get_string("notcalculated","block_lord")}}function D(a,b){var c=a.split("_"),d=function(a,b){return a<b?1:a>b?-1:0};if(Object.keys(ea[a]).length>0)for(var e,f,g,h,i,j,k,l,m,n,o,p=Object.keys(ea[a]).sort(d),q=!1,r=!1,s=M.util.get_string("optimalassign","block_lord")+":",t=0;t<p.length;t++){if("name"==(o=p[t]))e=M.util.get_string("names","block_lord"),l=$[c[0]].cname,m=$[c[1]].cname;else if(o.startsWith("intro"))q||(n=M.util.get_string("introscost","block_lord")+" "+c[1]+" x "+c[0],E(n,s,b,fa),q=!0),g=o.slice(5).split("x"),e=M.util.get_string("intros","block_lord")+" "+c[1]+" S"+g[1]+" x "+c[0]+" S"+g[0],l=$[c[0]].cintro[g[0]],m=$[c[1]].cintro[g[1]];else{if(!r){n=M.util.get_string("parascost","block_lord")+" "+c[1]+" x "+c[0],E(n,s,b,ha);for(var u in ga)g=u.split("_"),n=M.util.get_string("sentscost","block_lord")+" "+c[1]+" P"+g[1]+" x "+c[0]+" P"+g[0],E(n,s,b,ga[u]);r=!0}f=o.split("P"),g=f[1].split("S"),h=parseInt(g[0]),i=parseInt(g[1]),g=f[2].split("S"),j=parseInt(g[0]),k=parseInt(g[1]),e=c[1]+" P"+j+"S"+k+" x "+c[0]+" P"+h+"S"+i,l=aa[c[0]][h][i],m=aa[c[1]][j][k]}F(e,b,m,l,ea[a][o],W[a][o])}}function E(a,b,c,d){var e=document.createElement("table"),f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(a);g.appendChild(h),g.appendChild(document.createElement("br"));var i=document.createTextNode("   "+d.weight);g.appendChild(i),g.style.fontWeight="bold";var j=0;for(j=0;j<d.matrix.length;j++)g=f.insertCell(),h=document.createTextNode(j),g.appendChild(h);for(j=0;j<d.matrix.length;j++){f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(j),g.appendChild(h);for(var k=0;k<d.matrix[0].length;k++)g=f.insertCell(),h=document.createTextNode(d.matrix[j][k]),g.appendChild(h)}for(c.appendChild(e),e=document.createElement("table"),f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(b),g.appendChild(h),g.style.fontWeight="bold",j=0;j<d.optimal.length;j++)g=f.insertCell(),h=document.createTextNode(d.optimal[j]),g.appendChild(h);c.appendChild(e),c.appendChild(document.createElement("hr"))}function F(a,b,c,d,e,f){var g=document.createElement("table"),h=g.insertRow(),i=h.insertCell(),j=document.createTextNode(a);i.appendChild(j),i.appendChild(document.createElement("br"));var k=document.createTextNode("   "+f);if(i.appendChild(k),i.style.fontWeight="bold",!e)return b.appendChild(g),void b.appendChild(document.createElement("hr"));for(var l=c.split(" "),m=0;m<e[0].length;m++)i=h.insertCell(),j=document.createTextNode(l[m]),i.appendChild(j);l=d.split(" ");var n=0;e.forEach(function(a){h=g.insertRow(),i=h.insertCell(),j=document.createTextNode(l[n++]),i.appendChild(j),a.forEach(function(a){i=h.insertCell(),j=document.createTextNode(a.toFixed(6)),i.appendChild(j)})}),b.appendChild(g),b.appendChild(document.createElement("hr"))}function G(a){ia.stop();var b=H();b.time=Date.now(),b.iscustom=a?1:0,a?(ma.userscale=b.scale,ma.usergraph=b.nodes,ma.usermindist=qa.min,ma.usermaxdist=qa.max,ma.userdistscale=qa.scale,b.mindist=qa.min,b.maxdist=qa.max,b.distscale=qa.scale):(ma.systemscale=b.scale,ma.systemgraph=b.nodes,ma.systemmindist=ja,ma.systemmaxdist=ka,ma.systemdistscale=la,b.mindist=ja,b.maxdist=ka,b.distscale=la),I(X,b)}function H(){var a,b,c,d={},e=0,f=O/2,g=P/2;return S.nodes.forEach(function(d){a=d.x-f,b=d.y-g,(c=Math.sqrt(a*a+b*b))>e&&(e=c)}),d.scale=e,d.nodes={},S.nodes.forEach(function(a){d.nodes[a.id]={xcoord:""+(a.x-f)/e,ycoord:""+(a.y-g)/e}}),d.links=[],S.links.forEach(function(a){isNaN(a.source.id)||isNaN(a.target.id)||(d.links[d.links.length]={module1:a.source.id,module2:a.target.id,weight:a.weight})}),d}function I(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+Z+"&data="+JSON.stringify(b)+"&sesskey="+Y)}var J,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra;b(a)}});