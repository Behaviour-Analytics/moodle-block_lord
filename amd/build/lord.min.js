/*! moodle-block_lord v0.3.6 12-08-2020 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.lord=a()}(function(){return function(a){function b(a){O=a.modules,T=a.weights,U=a.coordsscript,W=a.courseid,V=a.sesskey,X=a.names,Y=a.paragraphs,Z=a.sentences,ba=a.matrices,$=a.comparisonweights,ja=a.presetnodes,G=window.dataDrivenDocs,H=window.munkres,I=c(),J={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown"},K=window.innerWidth-150,L=window.innerHeight-90,N=Math.min(K,L)<500?6:8,ga=25,ha=200,ia=1e3,ma=7e3,d(),Object.keys(ja.usergraph).length>0?(ka=ja.userscale,ga=ja.usermindist,ha=ja.usermaxdist,ia=ja.userdistscale,e(ja.usergraph),i(n,!0),j(),la=!0,u("usergraph")):Object.keys(ja.systemgraph).length>0?(ka=ja.systemscale,ga=ja.systemmindist,ha=ja.systemmaxdist,ia=ja.systemdistscale,e(ja.systemgraph),i(n,!0),j(),la=!1,u("systemgraph")):(e({}),i(m,!1),setTimeout(function(){D(!1),j(),la=!1,u("graphsaved"),R.call(G.drag().on("start",r).on("drag",s).on("end",t))},ma)),na={min:ga,max:ha,scale:ia}}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){O.forEach(function(a){for(;!J[a.entype];){var b=I[Math.floor(Math.random()*I.length)],c=!0;for(var d in J)J[d]==b&&(c=!1);J[a.entype]=c?b:void 0}})}function e(a){var b=[],c=[],d={},e={};O.forEach(function(f){e={id:f.id,name:f.name,type:f.type,entype:f.entype,colour:J[f.entype],visible:!0},a[f.id]&&(e.xcoord=a[f.id].xcoord,e.ycoord=a[f.id].ycoord),b[b.length]=e,d[f.sect]||(e={id:"g"+f.sect,name:M.util.get_string("section","block_lord")+" "+f.sect,group:f.sect,type:"grouping",colour:J.grouping,visible:!1},a["g"+f.sect]&&(e.xcoord=a["g"+f.sect].xcoord,e.ycoord=a["g"+f.sect].ycoord),d[f.sect]=e,b[b.length]=e),c[c.length]={source:"g"+f.sect,target:f.id,weight:0,colour:J.originalLinks}}),e={id:"root",name:"root",group:-1,type:"grouping",colour:J.grouping,visible:!1},a.root&&(e.xcoord=a.root.xcoord,e.ycoord=a.root.ycoord),b[b.length]=e;for(var g in d)c[c.length]={source:"root",target:d[g].id,weight:0,colour:J.originalLinks};var h,i;d={},O.forEach(function(a){O.forEach(function(b){h=parseInt(a.id)<parseInt(b.id)?a.id+"_"+b.id:b.id+"_"+a.id,a.id==b.id||d[h]||(d[h]=1,i=0,i=!T[h]||Array.isArray(T[h])?-.01:f(h),c[c.length]={source:a.id,target:b.id,weight:i,colour:J.originalLinks})})}),P={nodes:b,links:c}}function f(a){var b=0,c=0,d=0,e=0,f=0,i=[],j={},k={};for(var l in T[a])"name"==l?b+=parseFloat(T[a][l])*parseFloat($.names):l.startsWith("intro")?(j[l]=parseFloat(T[a][l]),i=l.slice(5).split("x"),parseInt(i[0])>c&&(c=parseInt(i[0])),parseInt(i[1])>c&&(c=parseInt(i[1]))):(i=l.split("P"),e=i[1].split("S"),d<e[0]&&(d=e[0]),f=i[2].split("S"),d<f[0]&&(d=f[0]),k[e[0]+"_"+f[0]]||(k[e[0]+"_"+f[0]]={}),k[e[0]+"_"+f[0]][e[1]+"_"+f[1]]=parseFloat(T[a][l]));var m=g(c,j),n=h(d,k);return 0!=n?(b+m+n)/3:(b+m)/2}function g(a,b){var c=[],d=0,e=0;for(d=0;d<=a;d++)for(c[d]=[],e=0;e<=a;e++)c[d][e]=-1e3;var f=[];d=0;for(d in b)f=d.slice(5).split("x"),c[parseInt(f[0])][parseInt(f[1])]=b[d];var g=H.make_cost_matrix(c),h=H(g),i=0,j=0,k=0;for(d=0;d<h.length;d++)(k=c[h[d][0]][h[d][1]])>=-1&&(i+=k,j++);return i=j>0?i/j:0,ca={matrix:c,optimal:h,weight:i},i*=parseFloat($.intros)}function h(a,b){var c=[],d=0,e=0;for(d=0;d<=a;d++)for(c[d]=[],e=0;e<=a;e++)c[d][e]=-1e3;var f=[],g=[],h=[],i=[],j=0,k=0,l=0,m=[],n=[],o=0,p=0,q=0,r=0;da={};for(var s in b)if(f=s.split("_"),i=Object.keys(b[s]),0!=i.length){j=0,k=0,l=0;for(q in i)g=i[q].split("_"),k=parseInt(g[0]),j<k&&(j=k),l=parseInt(g[1]),j<l&&(j=l);for(h=[],d=0;d<=j;d++)for(h[d]=[],e=0;e<=j;e++)h[d][e]=-1e3;for(q in i)g=i[q].split("_"),k=parseInt(g[0]),l=parseInt(g[1]),h[k][l]=b[s][i[q]];for(m=H.make_cost_matrix(h),n=H(m),p=0,o=0,d=0;d<n.length;d++)(r=h[n[d][0]][n[d][1]])>=-1&&(o+=r,p++);o=p>0?o/p:0,da[s]={matrix:h,optimal:n,weight:o},k=parseInt(f[0]),l=parseInt(f[1]),c[k][l]=o}m=H.make_cost_matrix(c),n=H(m);var t=0;for(p=0,r=0,d=0;d<n.length;d++)(r=c[n[d][0]][n[d][1]])>=-1&&(t+=r,p++);return t=p>0?t/p:0,ea={matrix:c,optimal:n,weight:t},t*=parseFloat($.sentences)}function i(a,b){Q&&(fa.stop(),Q.remove()),Q=G.select("#graph").append("svg").attr("width",K).attr("height",L).on("click",v);var c=G.forceLink(P.links).id(function(a){return a.id}).distance(function(a){var b=a.weight*-parseInt(ia);return b+=parseInt(ha)});fa=G.forceSimulation(P.nodes).force("link",c).force("collide",G.forceCollide().radius(parseInt(ga))).force("center",G.forceCenter(K/2,L/2)),R=Q.selectAll(".node").data(P.nodes).enter().append("circle").attr("class","node").attr("r",N).on("click",w).on("contextmenu",x).on("mouseover",o).on("mouseout",q),b&&R.call(G.drag().on("start",r).on("drag",s).on("end",t)),S=Q.selectAll(".link").data(P.links).enter().append("line").attr("class","link").style("stroke",J.originalLinks).style("stroke-width","2px"),fa.on("tick",a)}function j(){var a=document.getElementById("save-graph"),b=document.createElement("input");b.id="revert-button",b.type="button",b.value=M.util.get_string("systembutton","block_lord"),b.addEventListener("click",k),b.style.marginRight="20px",a.appendChild(b);var c=document.createElement("input");c.id="min-dist-slider",c.type="range",c.min="10",c.max="50",c.step="5",c.value=ga,c.style.width="100px",c.addEventListener("change",function(){ga=this.value,document.getElementById("min-dist-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(c);var d=document.createTextNode(M.util.get_string("mindistance","block_lord"));a.appendChild(d),d=document.createElement("label"),d.id="min-dist-output",d.innerHTML="&nbsp;= "+c.value,d.style.marginRight="20px",a.appendChild(d);var e=document.createElement("input");e.id="max-dist-slider",e.type="range",e.min="50",e.max="500",e.step="25",e.value=ha,e.style.width="100px",e.addEventListener("change",function(){ha=this.value,document.getElementById("max-dist-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(e),d=document.createTextNode(M.util.get_string("maxdistance","block_lord")),a.appendChild(d),d=document.createElement("label"),d.id="max-dist-output",d.innerHTML="&nbsp;= "+e.value,d.style.marginRight="20px",a.appendChild(d);var f=document.createElement("input");f.id="scale-slider",f.type="range",f.min="0",f.max="2000",f.step="100",f.value=ia,f.style.width="100px",f.addEventListener("change",function(){ia=this.value,document.getElementById("scale-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(f),d=document.createTextNode(M.util.get_string("scalingfactor","block_lord")),a.appendChild(d),d=document.createElement("label"),d.id="scale-output",d.innerHTML="&nbsp;= "+f.value,d.style.marginRight="20px",a.appendChild(d);var g=document.createElement("input");g.type="button",g.value=M.util.get_string("resetbutton","block_lord"),g.addEventListener("click",l),g.style.marginRight="20px",a.appendChild(g)}function k(){!la&&Object.keys(ja.usergraph).length>0?(ka=ja.userscale,ga=ja.usermindist,ha=ja.usermaxdist,ia=ja.userdistscale,e(ja.usergraph),i(n,!0),la=!0,u("usergraph"),document.getElementById("revert-button").value=M.util.get_string("systembutton","block_lord")):(ka=ja.systemscale,ga=ja.systemmindist,ha=ja.systemmaxdist,ia=ja.systemdistscale,e(ja.systemgraph),i(n,!0),la=!1,u("systemgraph"),document.getElementById("revert-button").value=Object.keys(ja.usergraph).length>0?M.util.get_string("custombutton","block_lord"):M.util.get_string("systembutton","block_lord")),na={min:ga,max:ha,scale:ia},document.getElementById("min-dist-slider").value=ga,document.getElementById("min-dist-output").innerHTML="&nbsp;= "+ga,document.getElementById("max-dist-slider").value=ha,document.getElementById("max-dist-output").innerHTML="&nbsp;= "+ha,document.getElementById("scale-slider").value=ia,document.getElementById("scale-output").innerHTML="&nbsp;= "+ia}function l(){e({}),i(m,!1),document.getElementById("save-graph").style.display="none",na={min:ga,max:ha,scale:ia},setTimeout(function(){la=!1,D(!1),u("graphsaved"),R.call(G.drag().on("start",r).on("drag",s).on("end",t)),document.getElementById("save-graph").style.display="block",document.getElementById("revert-button").value=M.util.get_string("custombutton","block_lord")},ma)}function m(){var a=N;R.attr("cx",function(b){return b.x=Math.max(a,Math.min(K-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(L-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),S.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 10*a.weight+"px"})}function n(){for(var a,b,c=K/2,d=L/2,e=ka,f=0;f<P.nodes.length;f++)a=P.nodes[f].xcoord*e+c,b=P.nodes[f].ycoord*e+d,(a<0||a>K||b<0||b>L)&&(e*=.9,--f);S.attr("x1",function(a){var b=P.nodes.filter(function(b){var c="string"==typeof a.source?a.source:a.source.id;return b.id==c})[0];return G.select(this).attr("y1",b.ycoord*e+d),b.xcoord*e+c}).attr("x2",function(a){var b=P.nodes.filter(function(b){var c="string"==typeof a.target?a.target:a.target.id;return b.id==c})[0];return G.select(this).attr("y2",b.ycoord*e+d),b.xcoord*e+c}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}).style("stroke-width",function(a){return 10*a.weight+"px"}),R.attr("cx",function(a){return a.x=a.xcoord*e+c,a.x}).attr("cy",function(a){return a.y=a.ycoord*e+d,a.y}).style("display",function(a){return a.visible?"block":"none"}).style("fill",function(a){return a.colour}).raise()}function o(a){G.selectAll(".text").remove(),G.selectAll("rect").remove();var b=[0],c=!1,d=!1,e=!1,f=150,g=304,h=a.type+" "+a.name,i=Q.append("text").attr("class","text").attr("id","t-"+a.id).attr("y",a.y+32).attr("dy",".40em").style("pointer-events","none").text(h).call(p,f,a.x-(f+6)/2+8,b),j=16*b[0]+16;j+a.y>=L-154&&(i.attr("y",L-j-(L-a.y)).text(h).call(p,f,a.x-(f+6)/2+8,b),c=!0),a.x<=g/2?(i.text(h).call(p,f,a.x+8,b),e=!0):a.x>=K-g/2&&(i.text(h).call(p,f,a.x-(f+6)+8,b),d=!0);var k;k=e?a.x:d?a.x-(f+6):a.x-(f+6)/2,Q.append("rect").attr("id","r-"+a.id).attr("x",k).attr("y",c?L-j-16-(L-a.y):a.y+16).attr("width",f+16).attr("height",j).style("stroke","black").style("fill","yellow"),i.raise()}function p(a,b,c,d){var e=0;a.each(function(){var a,d=G.select(this),f=d.text().split(/\s+/).reverse(),g=[],h=d.attr("y"),i=parseFloat(d.attr("dy")),j=d.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy",i+"em");for(a=f.pop();a;)g.push(a),j.text(g.join(" ")),j.node().getComputedTextLength()>b&&(g.pop(),j.text(g.join(" ")),g=[a],j=d.append("tspan").attr("x",c).attr("y",h).attr("dy",1.1*++e+i+"em").text(a)),a=f.pop()}),d[0]=++e}function q(){G.selectAll(".text").remove(),G.selectAll("rect").remove()}function r(a){G.event.active||(fa.on("tick",m),fa.alphaTarget(.01).restart()),a.fx=a.x,a.fy=a.y}function s(a){a.fx=G.event.x,a.fy=G.event.y}function t(a){a.fx=null,a.fy=null,la=!0,D(!0),document.getElementById("revert-button").value=M.util.get_string("systembutton","block_lord"),u("graphsaved")}function u(a){var b=document.getElementById("save-graph"),c=document.createElement("label");c.innerHTML=M.util.get_string(a,"block_lord"),b.appendChild(c),setTimeout(function(){c.remove()},2e3)}function v(){document.getElementById("node-content-left").innerHTML="&nbsp",document.getElementById("node-content-right").innerHTML="&nbsp",document.getElementById("similarity-score").innerHTML="&nbsp",document.getElementById("similarity-matrix").innerHTML="&nbsp",_=void 0,aa=void 0}function w(a){G.event.stopPropagation(),a.id!=aa&&(_=a.id,y(a,"node-content-left"))}function x(a){G.event.preventDefault(),a.id!=_&&(aa=a.id,y(a,"node-content-right"))}function y(a,b){var c="<b>"+M.util.get_string("moduleid","block_lord")+": "+a.id+"<br>"+M.util.get_string("name","block_lord")+": </b>"+X[a.id].name+"<br><b>"+M.util.get_string("intro","block_lord")+": </b>"+X[a.id].intro+"<br>";if(Y[a.id]){var d=0;Y[a.id].forEach(function(a){c+="<b>P"+d+": </b>"+a+"<br>",d++})}document.getElementById(b).innerHTML=c,z()}function z(){if(_&&aa){var a=document.getElementById("similarity-score"),b=parseInt(_)<parseInt(aa)?_+"_"+aa:aa+"_"+_;if(Object.keys(T[b]).length>0){var c=f(b);0==c?a.innerHTML=M.util.get_string("comparisonerror","block_lord"):(a.innerHTML=M.util.get_string("similaritystr","block_lord")+" "+c,A(b))}else a.innerHTML=M.util.get_string("notcalculated","block_lord")}}function A(a){var b=document.getElementById("similarity-matrix");b.innerHTML="&nbsp;";var c=a.split("_"),d=function(a,b){return a<b?1:a>b?-1:0};if(Object.keys(ba[a]).length>0)for(var e,f,g,h,i,j,k,l,m,n,o,p=Object.keys(ba[a]).sort(d),q=!1,r=!1,s=M.util.get_string("optimalassign","block_lord")+":",t=0;t<p.length;t++){if("name"==(o=p[t]))e=M.util.get_string("names","block_lord"),l=X[c[0]].cname,m=X[c[1]].cname;else if(o.startsWith("intro"))q||(n=M.util.get_string("introscost","block_lord")+" "+c[1]+" x "+c[0],B(n,s,b,ca),q=!0),g=o.slice(5).split("x"),e=M.util.get_string("intros","block_lord")+" "+c[1]+" S"+g[1]+" x "+c[0]+" S"+g[0],l=X[c[0]].cintro[g[0]],m=X[c[1]].cintro[g[1]];else{if(!r){n=M.util.get_string("parascost","block_lord")+" "+c[1]+" x "+c[0],B(n,s,b,ea);for(var u in da)g=u.split("_"),n=M.util.get_string("sentscost","block_lord")+" "+c[1]+" P"+g[1]+" x "+c[0]+" P"+g[0],B(n,s,b,da[u]);r=!0}f=o.split("P"),g=f[1].split("S"),h=parseInt(g[0]),i=parseInt(g[1]),g=f[2].split("S"),j=parseInt(g[0]),k=parseInt(g[1]),e=c[1]+" P"+j+"S"+k+" x "+c[0]+" P"+h+"S"+i,l=Z[c[0]][h][i],m=Z[c[1]][j][k]}C(e,b,m,l,ba[a][o],T[a][o])}}function B(a,b,c,d){var e=document.createElement("table"),f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(a);g.appendChild(h),g.appendChild(document.createElement("br"));var i=document.createTextNode("   "+d.weight);g.appendChild(i),g.style.fontWeight="bold";var j=0;for(j=0;j<d.matrix.length;j++)g=f.insertCell(),h=document.createTextNode(j),g.appendChild(h);for(j=0;j<d.matrix.length;j++){f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(j),g.appendChild(h);for(var k=0;k<d.matrix[0].length;k++)g=f.insertCell(),h=document.createTextNode(d.matrix[j][k]),g.appendChild(h)}for(c.appendChild(e),e=document.createElement("table"),f=e.insertRow(),g=f.insertCell(),h=document.createTextNode(b),g.appendChild(h),g.style.fontWeight="bold",j=0;j<d.optimal.length;j++)g=f.insertCell(),h=document.createTextNode(d.optimal[j]),g.appendChild(h);c.appendChild(e),c.appendChild(document.createElement("hr"))}function C(a,b,c,d,e,f){var g=document.createElement("table"),h=g.insertRow(),i=h.insertCell(),j=document.createTextNode(a);i.appendChild(j),i.appendChild(document.createElement("br"));var k=document.createTextNode("   "+f);if(i.appendChild(k),i.style.fontWeight="bold",!e)return b.appendChild(g),void b.appendChild(document.createElement("hr"));for(var l=c.split(" "),m=0;m<e[0].length;m++)i=h.insertCell(),j=document.createTextNode(l[m]),i.appendChild(j);l=d.split(" ");var n=0;e.forEach(function(a){h=g.insertRow(),i=h.insertCell(),j=document.createTextNode(l[n++]),i.appendChild(j),a.forEach(function(a){i=h.insertCell(),j=document.createTextNode(a.toFixed(6)),i.appendChild(j)})}),b.appendChild(g),b.appendChild(document.createElement("hr"))}function D(a){fa.stop();var b=E();b.time=Date.now(),b.iscustom=a?1:0,a?(ja.userscale=b.scale,ja.usergraph=b.nodes,ja.usermindist=na.min,ja.usermaxdist=na.max,ja.userdistscale=na.scale,b.mindist=na.min,b.maxdist=na.max,b.distscale=na.scale):(ja.systemscale=b.scale,ja.systemgraph=b.nodes,ja.systemmindist=ga,ja.systemmaxdist=ha,ja.systemdistscale=ia,b.mindist=ga,b.maxdist=ha,b.distscale=ia),F(U,b)}function E(){var a,b,c,d={},e=0,f=K/2,g=L/2;return P.nodes.forEach(function(d){a=d.x-f,b=d.y-g,(c=Math.sqrt(a*a+b*b))>e&&(e=c)}),d.scale=e,d.nodes={},P.nodes.forEach(function(a){d.nodes[a.id]={xcoord:""+(a.x-f)/e,ycoord:""+(a.y-g)/e}}),d}function F(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+W+"&data="+JSON.stringify(b)+"&sesskey="+V)}var G,H,I,J,K,L,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na;b(a)}});